name: bam_variant_calling_somatic_mutect2
description: |
  Perform variant calling on a paired tumor normal set of samples using mutect2 tumor normal mode.
  f1r2 output of mutect2 is run through learnreadorientationmodel to get the artifact priors.
  Run the input bam files through getpileupsummarries and then calculatecontamination to get the contamination and segmentation tables.
  Filter the mutect2 output vcf using filtermutectcalls, artifact priors and the contamination & segmentation tables for additional filtering.
  Optional joint calling of multiple tumor.
keywords:
  - calculatecontamination
  - filtered_vcf
  - filtermutectcalls
  - gatk4
  - getpileupsummaries
  - learnreadorientationmodel
  - mutect2
  - variant_calling
modules:
  - gatk4/calculatecontamination
  - gatk4/filtermutectcalls
  - gatk4/gatherpileupsummaries
  - gatk4/getpileupsummaries
  - gatk4/learnreadorientationmodel
  - gatk4/mergemutectstats
  - gatk4/mergevcfs
  - gatk4/mutect2
input:
  - meta:
      type: map
      description: |
        Groovy Map containing sample information
        e.g. [ id:'test' ]
  - input:
      type: list
      description: list containing the tumor and normal BAM files, in that order, also able to take CRAM as an input
      pattern: "[ *.{bam/cram} ]"
  - input_index:
      type: list
      description: list containing the tumor and normal BAM file indexes, in that order, also able to take CRAM index as an input
      pattern: "[ *.{bam.bai/cram.crai} ]"
  - fasta:
      type: file
      description: The reference fasta file
      pattern: "*.fasta"
  - fai:
      type: file
      description: Index of reference fasta file
      pattern: "*.fasta.fai"
  - dict:
      type: file
      description: GATK sequence dictionary
      pattern: "*.dict"
  - germline_resource:
      type: file
      description: Population vcf of germline sequencing, containing allele fractions.
      pattern: "*.vcf.gz"
  - germline_resource_tbi:
      type: file
      description: Index file for the germline resource.
      pattern: "*.vcf.gz.tbi"
  - panel_of_normals:
      type: file
      description: vcf file to be used as a panel of normals.
      pattern: "*.vcf.gz"
  - panel_of_normals_tbi:
      type: file
      description: Index for the panel of normals.
      pattern: "*.vcf.gz.tbi"
  - interval_file:
      type: file
      description: File containing intervals.
      pattern: "*.interval_list"
  - joint_mutect2:
      type: boolean
      description: Boolean to indicate whether to run mutect2 in joint mode.
      default: false
output:
  - versions:
      type: file
      description: File containing software versions
      pattern: "versions.yml"
  - vcf:
      type: file
      description: Compressed vcf file to be used for variant_calling.
      pattern: "[ *.vcf.gz ]"
  - tbi:
      type: file
      description: Indexes of the vcf file
      pattern: "[ *vcf.gz.tbi ]"
  - stats:
      type: file
      description: Stats files for the mutect2 vcf
      pattern: "[ *vcf.gz.stats ]"
  - vcf_filtered:
      type: file
      description: Compressed and filtered vcf file to be used for variant_calling.
      pattern: "[ *.vcf.gz ]"
  - index_filtered:
      type: file
      description: Indexes of the vcf_filtered file
      pattern: "[ *vcf.gz.tbi ]"
  - stats_filtered:
      type: file
      description: Stats files for the mutect2 vcf_filtered
      pattern: "[ *vcf.gz.stats ]"
  - artifact_priors:
      type: file
      description: file containing artifact-priors to be used by filtermutectcalls.
      pattern: "*.tar.gz"
  - pileup_table_tumor:
      type: file
      description: File containing the tumor pileup summary table, kept separate as calculatecontamination needs them individually specified.
      pattern: "*_tumor.pileups.table"
  - pileup_table_normal:
      type: file
      description: File containing the normal pileup summary table, kept separate as calculatecontamination needs them individually specified.
      pattern: "*_normal.pileups.table"
  - contamination_table:
      type: file
      description: File containing the contamination table.
      pattern: "*.contamination.table"
  - segmentation_table:
      type: file
      description: Output table containing segmentation of tumor minor allele fractions.
      pattern: "*.segmentation.table"
authors:
  - "@GCJMackenzie"
  - "@maxulysse"
